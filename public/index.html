<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
    <style>

    .chart div {
    font: 10px sans-serif;
    padding-right: 1px;
    margin: 1px;
    color: white;
    text-align: right;
    }

    .background {
    fill: none;
    pointer-events: all;
    }

    #states {
    fill: #333444;
    }

    #states .active {
    fill: rgb(254,201,56);
    }

    #state-borders {
    fill: none;
    stroke: #fff;
    stroke-width: 1.5px;
    stroke-linejoin: round;
    stroke-linecap: round;
    pointer-events: none;
    }

    #title {
      background-color: black;
      color: rgb(254,201,56);
    }

    </style>
  </head>
  <body>
    <h1 id="title">Refugee Data Visualizer</h1>
    <div>
      <h2 id="countries-header">Countries</h2>
    </div>
    <div>
      <h2 id="states-header">States</h2>
    </div>
    <div class="chart">
      <h2>Syrians Resettled in 2014 (by State)</h2>
    </div>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script>

    // Plan to modify extensively and understand what is going on, will comment further
    // Copied From http://bl.ocks.org/mbostock/2206590, Mike Bostocks - This Iteration
    var width = 960,
        height = 500,
        centered;

    var projection = d3.geo.albersUsa()
        .scale(1000)
        .translate([width / 2, height / 2]);

    var path = d3.geo.path()
        .projection(projection);

    var svg = d3.select("body").append("svg")
        .attr("width", width)
        .attr("height", height);

    svg.append("rect")
        .attr("class", "background")
        .attr("width", width)
        .attr("height", height)
        .on("click", clicked);

    var g = svg.append("g");

    d3.json("us-10m.json", function(error, us) {
      if (error) throw error;

      g.append("g")
          .attr("id", "states")
        .selectAll("path")
          .data(topojson.feature(us, us.objects.states).features)
        .enter().append("path")
          .attr("d", path)
          .attr("fill", function (d,i) {
            console.log(i);
            return "rgb(200,200," + i*10 + ")";
          })
          .on("click", clicked);

      g.append("path")
          .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
          .attr("id", "state-borders")
          .attr("d", path);
    });

    function clicked(d) {
      var x, y, k;

      if (d && centered !== d) {
        var centroid = path.centroid(d);
        x = centroid[0];
        y = centroid[1];
        k = 4;
        centered = d;
      } else {
        x = width / 2;
        y = height / 2;
        k = 1;
        centered = null;
      }

      g.selectAll("path")
          .classed("active", centered && function(d) { return d === centered; });

      g.transition()
          .duration(750)
          .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
          .style("stroke-width", 1.5 / k + "px");
    }


    // Me playing around with attaching data to the screen

    var statesArray = [];
    // numbers of individuals per state from SYRIA for 2014_refugees
    var perStateFromSYRIA =[];
    var countriesArray = [];

    var SYRIA = 65;

    var a = d3.select("body").append("div");

    // getting data from json file, pushing data to arrays
    d3.json("2014_refugees.json", function(error, data) {
      if (error) return console.error(error);
      a.selectAll("a")
       .data(data.Columns)
       .enter()
        .append("a")
        .attr("href", function (d) {
         return "https://en.wikipedia.org/wiki/" + d.toLowerCase();
        })
        .text(function (d) {
          countriesArray.push(d);
        //  return d + " :)";
       })
        .data(data.Rows)
          .append("p")
          .text(function (d) {
            console.log(d3.keys(d));
            console.log(d3.values(d)[0][SYRIA]);
            statesArray.push(d3.keys(d)[0]);
            perStateFromSYRIA.push(d3.values(d)[0][SYRIA]);
            // return d3.keys(d) + d3.values(d);
          });

        //creating bar chart for syrian resettlement in 2014 by state with some styling
        var x = d3.scale.linear()
            .domain([0, d3.max(perStateFromSYRIA.slice(0,49))])
            .range([0, 820]);

        d3.select(".chart")
          .selectAll("div")
            .data(perStateFromSYRIA.slice(0,49))
          .enter().append("div")
            .style("width", function(d) { return x(d+5) + "px"; })
            .style("background-color", function (d) {return "rgba(255,0,"+ d*15 + ",0.7)"})
            .append("span")
            .text(function(d,i) { return d + " " + statesArray[i]; })
            .style("font-size", "9px");

    });

    // printing the columnar data (mostly countries)
    d3.json("2014_refugees.json", function (error, data) {
        if (error) return console.error(error);
        d3.select("#countries-header")
        .data(data.Columns)
          .append("p")
          .text(function (d) {
            return countriesArray.toString().split(",").join(", ");
          })
          .style("font-size", "12px");

        d3.select("#states-header")
        .data(data.Rows)
          .append("p")
          .text(function (d) {
            return statesArray.toString().split(",").join(", ");
          })
          .style("font-size", "12px");
    });

    // NEED ARRAY TO MAP ORDERED ARRAY OF STATES TO PATHS
    var mappingArray = ["WASHINGTON", "MONTANA", "IDAHO", "NORTH DAKOTA"];


    </script>
  </body>
</html>
