<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Refugee Data Visualizer</title>
    <style>
      body {
        font-family: Helvetica, sans-serif;
      }
      .left-container {
        display: inline-block;
      }

      .middle-container {
        display: inline-block;
        position: absolute;
        height: 560px;
      }
      .map-container {
        position: relative;
      }
      .chart-container {
        position: relative;
        top: -39px;
      }
      .countries-container {
        -webkit-column-count: 2; /* Chrome, Safari, Opera */
        -moz-column-count: 2; /* Firefox */
        column-count: 2;
        height: 560px;
        overflow: scroll;
        width: 200px;
        display: inline-block;
      }
      .bar {
        fill: rgba(0,0,0,0.5);
      }

      .bar:hover {
        fill: rgb(253,200,47);
      }

      .axis {
        font: 10px sans-serif;
      }

      .axis path,
      .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      .x.axis path {
        display: none;
      }

      .background {
      fill: none;
      pointer-events: all;
      }

      #states {
      fill: #333444;
      }

      #states .active {
      fill: rgb(253,200,47);
      }

      #state-borders {
      fill: none;
      stroke: #fff;
      stroke-width: 1.5px;
      stroke-linejoin: round;
      stroke-linecap: round;
      pointer-events: none;
      }

      #title {
        margin-bottom: 10px;
        background-color: white;
        color: rgb(253,200,47);
      }

    </style>
  </head>
  <body>
    <header>
      <h1 id="title">Refugee Data Visualizer</h1>
    </header>
    <div class="overall-container">
      <div class="left-container">
        <div class="countries-container"></div>
      </div>

      <div class="middle-container">
        <div class="map-container"></div>
        <div class="chart-container"></div>
      </div>

      <div class="right-container">
        <div class="news-stats-container">
        </div>
      </div>
    </div>

    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script>

    // Plan to modify extensively and understand what is going on, will comment further
    // Started with map and chart from http://bl.ocks.org/mbostock/
    var width = 860,
        height = 450,
        centered;

    var projection = d3.geo.albersUsa()
        .scale(900)
        .translate([width / 2, height / 2]);

    var path = d3.geo.path()
        .projection(projection);

    var svg = d3.select(".map-container").append("svg")
        .attr("width", width)
        .attr("height", height);

    svg.append("rect")
        .attr("class", "background")
        .attr("width", width)
        .attr("height", height);
        // .on("mouseover", mousedover);

    var g = svg.append("g");

    var statesGeoArray = [];

    d3.json("us-10m.json", function(error, us) {
      if (error) throw error;
      console.log(us);
      // console.log(us.objects.states.geometries[i].id);
      g.append("g")
          .attr("id", "states")
        .selectAll("path")
          .data(topojson.feature(us, us.objects.states).features)
        .enter().append("path")
          .attr("d", path)
          .attr("fill", function (d,i) {
            statesGeoArray.push(us.objects.states.geometries[i].id)
            //the drawn order array returns the index of the state
            //i want to scale the color based on number of individuals.  more indivduals should be higher in color, less should be lower in color
            var scaled = d3.scale.linear().domain([0,d3.max(perStateFromSYRIA.slice(0,51))]).range([5,98]);
            return "hsl(45,"+scaled(perStateFromSYRIA.slice(0,51)[drawnOrderStatesNumberArray[i]]) + "%,59%)";
          });
          // .on('mouseover', function(d, i) {
          //       var currentState = this;
          //       d3.select(this)
          //       .style('fill-opacity', 0.4)};

      g.append("path")
          .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
          .attr("id", "state-borders")
          .attr("d", path);
    });

    // function mousedover(d) {
    //
    //   g.selectAll("path")
    //       .classed("active", centered && function(d) { return d === centered; });
    //
    //   g.transition()
    //       .duration(750)
    //       .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")scale(" + k + ")translate(" + -x + "," + -y + ")")
    //       .style("stroke-width", 1.5 / k + "px");
    // }


    // Me playing around with attaching data to the screen

    var statesArray = [];
    // numbers of individuals per state from SYRIA for 2014_refugees
    var perStateFromSYRIA =[];
    var countriesArray = [];

    var SYRIA = 65;



    // getting data from json file, pushing data to arrays
    d3.json("2014_refugees.json", function(error, data) {
      if (error) return console.error(error);
      d3.select(".countries-container").selectAll("span")
       .data(data.Columns)
       .enter()
        .append("span")
        .text(function (d) {
          countriesArray.push(d);
        })
        .data(data.Rows)
          .append("span")
          .text(function (d) {
            statesArray.push(d3.keys(d)[0]);
            perStateFromSYRIA.push(d3.values(d)[0][SYRIA]);
          });
    });

    // printing the columnar data (mostly countries)
    d3.json("2014_refugees.json", function (error, data) {
        if (error) return console.error(error);
        d3.select(".countries-container").selectAll("li")
        .data(data.Columns)
          .enter()
          .append("li")
          .text(function (d, i) {
            return countriesArray[i].toString().split(",").join(", ")
          })
          .style("font-size", "0.68em")
          .style("color", "grey")
          .style("list-style", "none");
    });

    // NEED ARRAY TO MAP ORDERED ARRAY OF STATES TO PATHS
    var drawnOrderStatesNameArray = ["WASHINGTON", "MONTANA", "IDAHO", "NORTH DAKOTA", "MINNESOTA", "MAINE", "MICHIGAN", "WISCONSIN", "OREGON", "SOUTH DAKOTA", "NEW HAMPSHIRE", "VERMONT", "NEW YORK", "WYOMING", "IOWA",
    "NEBRASKA", "MASSACHUSETTS", "ILLINOIS", "PENNSYLVANIA", "CONNECTICUT", "RHODE ISLAND", "CALIFORNIA",
    "UTAH", "NEVADA", "OHIO", "INDIANA", "NEW JERSEY","COLORADO","WEST VIRGINIA",
    "MISSOURI", "KANSAS", "DELAWARE", "MARYLAND","VIRGINIA","KENTUCKY", "DISTRICT OF COLUMBIA", "ARIZONA", "OKLAHOMA", "NEW MEXICO", "TENNESSEE", "NORTH CAROLINA", "TEXAS", "ARKANSAS","SOUTH CAROLINA", "ALABAMA","GEORGIA","MISSISSIPPI","LOUISIANA","FLORIDA","HAWAII","ALASKA"];
    var drawnOrderStatesNumberArray = [47,26,12,34,23,19,22,49,37,41,29,45,32,50,15,27,21,13,38,6,39,4,44,28,35,14,30,5,48,25,16,7,20,46,17,8,2,36,31,42,33,43,3,40,0,10,24,18,9,11,1];
    //trying a vertical bar chart
    var margin = {top: 20, right: 20, bottom: 80, left: 40},
        width = 830 - margin.left - margin.right,
        height = 180 - margin.top - margin.bottom;

    var x = d3.scale.ordinal()
        .rangeRoundBands([0, width], .1);

    var y = d3.scale.linear()
        .range([height, 0]);

    var xAxis = d3.svg.axis()
        .scale(x)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .orient("left")
        .ticks(10);

    var svg = d3.select(".chart-container")
        .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    d3.json("2014_refugees.json", function(error, data) {
      if (error) throw error;

      x.domain(statesArray.slice(0,51).map(function(d) { return d; }));
      y.domain([0, d3.max(perStateFromSYRIA.slice(0,51))]);

      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis)
            .selectAll("text")
            .style("text-anchor", "end")
            .style("font-size", "0.85em")
            .attr("dx", "-.7em")
            .attr("dy", "0em")
            .attr("transform", "rotate(-45)" );;

      svg.append("g")
          .attr("class", "y axis")
          .call(yAxis)
        .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .style("font-size", "1.0em")
          .text("People Resettled");

      svg.selectAll(".bar")
          .data(perStateFromSYRIA.slice(0,51))
        .enter().append("rect")
          .attr("class", "bar")
          .attr("x", function(d,i) { return x(statesArray[i]); })
          .attr("width", x.rangeBand())
          .attr("y", function(d) { return y(d); })
          .attr("height", function(d) { return height - y(d); });
    });
    </script>
  </body>
</html>
